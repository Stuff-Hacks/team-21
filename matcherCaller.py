import subprocess
import binascii
from pydub import AudioSegment


def convAudio(fileName):
    sound = AudioSegment.from_mp3(fileName+".mp3")
    sound.export(fileName+".wav", format="wav")

def getSimilarity():
    p1 = subprocess.Popen(["/usr/bin/java", "matcher"], stdout=subprocess.PIPE)
    print(p1.stdout.read())

def getWord(audioFileName, recordings):
    convAudio(audioFileName)
    hexStr = ','.join([binascii.hexlify(bytearray(fp[0])) for fp in recordings])

    p1 = subprocess.Popen(["/usr/bin/java", "matcher", "getSimilarity", audioFileName+".wav", hexStr], stdout=subprocess.PIPE)
    output = p1.stdout.read()
    return recordings[int(output)][0]

def getFingerPrint(audioFileName):
    convAudio(audioFileName)
    p1 = subprocess.Popen(["/usr/bin/java", "matcher", "getFingerPrint", audioFileName+".wav"], stdout=subprocess.PIPE)
    output = p1.stdout.read()


    return bytearray(output)

'''print(getFingerPrint('appa'))

byteStuff = '0000004F7AE555880000008276F722D10000017774036DAB000001E96EE497A5000100597ABDCAC700010080777266650001017774D7E0AF000101EB6F1D6D410002002C7956B9930002008276549D5F00020177734DE7F4000201C56E7CB16E00030011791D03DD0003008374FBB9DA0003011A731093A3000301C56EEF4F2E0004001178A2DB790004008073F5FCE00004011B72A7B4ED000401E76F854DC5000500107950C4A100050080743BD9F00005017871EF25E0000501806F745C4200060023793E4ED100060085749E9E280006016272CCFC2C000601D070A4B0C8000700237A4D33A4000700867588C5AB0007016272D5DC02000701D070EC02BE000800227B1FD1150008009B75D49AAF0008016671CA5685000801CC7169B5220009001A7B9F4B2C0009009B7826FE770009014E724B4A9A000901C371C3267A000A00537E1DE7D8000A00987C84512F000A016473AFFAF8000A01867390C89F000B00537FFFFFFF000B00987EA4C73A000B01657506661F000B0186740E84E2000C00537FD4CE01000C00987DF83244000C0114741B8209000C01B071D68446000D000E7F2B1764000D00927AE9EDD4000D0114727C782E000D01FC6FF0ACD7000E000F7D2722F3000E009F776DE14C000E0103701DB040000E01E96DD54DCF000F002C7A7B6187000F009872BC0721000F015F6C25228C000F01836CFE55400010002D7A94DE0F00100098748C6F350010015872B5E43100100180703DB3D5001100407CCBE2A000110080787098F10011015875FCE9490011018A72070FAF0012007A7D14F1EB0012008079FA96A70012010576DFC2E50012018A73535ED9001300467D1EF906001300807890AA140013010675C773C20013018B7331C857001400467B429224001400817680FAB900140158734A3CFE0014018171C2A4C500150045794517340015008A759441C70015015D73296FBB001501816FC179260016001F79F826370016008A75603E930016015C72D444DA001601816CDD26940017001F7AB2ABF20017008A7387C9340017015C720CF4A6001701C57019ACB80018001F79E0E3570018009D71F8A6FE0018015C718153D7001801C570F5C3C80019002E791A51B90019009D733FD01C0019015D716BB5A1001901FE713F0868001A002E784C6EF6001A009E736897AD001A017C7140142B001A01F8714483AF001B001E77220F90001B00A3741C141A001B011B714A3D9C001B01F86FD220E1001C001E77573FE5001C00A275890FA1001C011B71C2267B001C01FA6CCB3A1B001D001D75DFDBC1001D0095742F85FB001D011A700C0235001D01FA6C98EB56001E004777A7A79E001E0098735E1DF7001E011B6E2D3AA9001E01F96BDF26C7001F004678A3B1E7001F009974B6C27C001F011B6FA8F496001F01816C51242A00200046788526220020008C767FA7070020011B6F9E074F002001816C0C81950021004678BF3F030021008C7796BB0B0021015C6FD123C6002101A16BF825FC00220039795E94540022008B773498C00022015C6F082410002201F66D3ED99B0023003978A32FF20023008B772BF8170023017C71B367BB002301F67332F1D3'
print(getWord('appa', [(byteStuff, 'appa')]))'''
